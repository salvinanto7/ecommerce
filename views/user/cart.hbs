<section>
  <div class='container'>
    <h4 class='mt-3'>
      Shopping Cart
    </h4>
    <div class='row'>
      <table class='table mt-5'>
        <thead>
          <tr>
            <th scope='col'> 
              Item
            </th>
            <th scope='col'>
              Product
            </th>
            <th scope='col'>
              Description
            </th>
            <th scope="col">
              Price
            </th>
            <th scope="col">
              Quantity
            </th>
          </tr>
        </thead>
        <tbody>
          {{#each cartProds}}
            <tr>
              <td>
                <img src="/product-images/{{this.product._id}}.jpg" alt="" style="width:50px;height:50px;">
              </td>
              <td>
                {{this.product.name}}
                </td>
              <td>
                {{this.product.description}}
              </td>
              <td>
                {{this.product.price}}
              </td>
              <td>
                <button class=" btn btn-primary mr-3" onclick="changeCount('{{this._id}}','{{this.product._id}}',-1)">-</button>
                <span id="{{this.product._id}}">{{this.quantity}}</span>
                <button class="btn btn-primary ml-3" onclick="changeCount('{{this._id}}','{{this.product._id}}',1)">+</button>
              </td>
              <td>
                <a href="" class="btn btn-danger">Remove</a>
              </td>
            </tr>
          {{/each}}
        </tbody>
      </table>
    </div>
  </div>
</section>

<script>
  function changeCount(cartId,prodId,val){
    let quantity = parseInt(document.getElementById(prodId).innerHTML)
    val = parseInt(val)
    $.ajax({
      url:'/change-product-quantity',
      data:{
        cart:cartId,
        product:prodId,
        count:val,
        quantity:quantity
      },
      method:'post',
      success:(response)=>{
        if(response.removeProduct){
          console.log("if case executed")
          alert("Product removed from cart")
          location.reload()
        }else{
          console.log("else case update count")
          document.getElementById(prodId).innerHTML=quantity+val
        }
        
      }
    })
  }
</script>